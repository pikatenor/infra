{"ignition":{"version":"3.0.0"},"passwd":{"users":[{"groups":["sudo","docker"],"name":"pikatenor","sshAuthorizedKeys":["ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC36FbIqKHklUPt+++qn8ZsMZsofIzFEIx33MiWTkAMOQhycW9t9zo6QXgOMogwB6xal5DLFWo87ETEqJH5TP38BF0AJRewDpVSrXoYHNvmAwQ7OGc7XP7XYwO+sznUUWSmKWUJseq8qYLys4tIupOJsS7zrgjxuQBv94UlTwK3eQm/fyT5Hdute0qcDeJ46cX+yBxg1wQn2a0lnSyv5WSA7XuKTIHCMeQftyg6/pRlXlpSlB/L2g1l8vBo96aFKYq2CWi+Ot70IDx+SwI1pafNmH2KUpQikcf2eATD/CSdKwm3siWs/AgEOh1zxxU2RGTFT49SUWHjvwW1xATJa5+/ pikatenor@Minerva5"]}]},"systemd":{"units":[{"contents":"[Unit]\nDescription=Set VPC private address\nAfter=network-online.target\nWants=network-online.target\n[Service]\nType=oneshot\nExecStart=/usr/bin/bash -c \"set -x; set -eo pipefail; metadata=$(curl -fsSL http://169.254.169.254/v1.json); private_device=$(nmcli d show | grep 'GENERAL.DEVICE' | grep 'en' | tail -n1 | awk '{print $2}'); private_address=$(echo $metadata | jq -r '.interfaces[] | select(.[\\\"network-type\\\"]==\\\"private\\\") | .ipv4.address'); nmcli con add type ethernet con-name private-net ifname $private_device ethernet.mtu 1450 ip4 $private_address/24\"\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"set-private.service"},{"contents":"[Unit]\nDescription=Set Hostname\nAfter=network-online.target\nWants=network-online.target\n[Service]\nType=oneshot\nExecStart=/usr/bin/bash -c \"set -x; set -eo pipefail; hostnamectl set-hostname $(curl -fsSL http://169.254.169.254/v1.json | jq -r .hostname); \"\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"set-hostname.service"},{"contents":"[Unit]\nDescription=Write Private IP address for k3s\nAfter=network-online.target\nWants=network-online.target\n[Service]\nType=oneshot\nExecStart=/usr/bin/bash -c \"echo -e \\\"PRIVATE_IP=$(curl -fsSL http://169.254.169.254/v1.json | jq -r '.interfaces[] | select(.[\\\"network-type\\\"]==\\\"private\\\") | .ipv4.address')\\nPRIVATE_DEVICE=$(ls -1 /sys/class/net | grep en | tail -n1)\\\" \u003e /etc/default/k3s\"\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"write-private-ip.service"}]}}
